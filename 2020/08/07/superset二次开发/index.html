<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  
  
    <meta name="description" content="前端,Hexo,技术">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    从前端角度记录superset二次开发 |
    
    JL&#39;s Blog</title>
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">
  
  <script src="/js/pace.min.js"></script>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>
</html>
<body>
<main class="content">
  <section class="outer">
  <article id="post-superset二次开发" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

    <div class="article-inner">
        
            <header class="article-header">
                
  
    <h1 class="article-title" itemprop="name">
      从前端角度记录superset二次开发
    </h1>
  
  




            </header>
            

                
                    <div class="article-meta">
                        <a href="/2020/08/07/superset二次开发/" class="article-date">
  <time datetime="2020-08-07T03:26:12.000Z" itemprop="datePublished">2020-08-07</time>
</a>
                            
                    </div>
                    

                        
                            
    <div class="tocbot"></div>





                                

                                    <div class="article-entry" itemprop="articleBody">
                                        


                                            

                                                
                                                                    <p>项目里 superset 版本是 0.36.0, python 版本是 3.6, 网上大部分资料都是后端开发人员贡献的，这篇文章我从一个前端的角度记录一下 superset 二次开发遇到的一些问题和解决方法。<br><a id="more"></a><br>先讲一下项目的大概结构：</p>
<ul>
<li>整个项目的后台代码使用了 python，这部分放在项目根目录的 superset 目录下</li>
<li>一整个后台的框架页面使用了 jinjia2，在项目根目录/superset/templates 下查看</li>
<li>页面上图表相关的展示和操作使用了 react，在/superset-frontend 目录下查看</li>
<li>前端打包后的页面放在/superset/static 目录下</li>
</ul>
<h4 id="1-修改-添加生成图表的表单项"><a href="#1-修改-添加生成图表的表单项" class="headerlink" title="1. 修改/添加生成图表的表单项"></a>1. 修改/添加生成图表的表单项</h4><p>src/explore目录中都是生成图表的表单项相关的代码，如果想添加一项只用在src/explore/controls.jsx文件中，模拟controls对象中的一项去添加一个属性，如添加一个’all_columns_x’</p>
<pre class=" language-javascript"><code class="language-javascript">all_columns_x<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">'SelectControl'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//可以在explore/components/controls目录中找到对应的组件</span>
    label<span class="token punctuation">:</span> <span class="token string">'X'</span><span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    description<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">'Columns to display'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    mapStateToProps<span class="token punctuation">:</span> state <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      choices<span class="token punctuation">:</span> <span class="token function">columnChoices</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>datasource<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
<h4 id="2-修改透视表-Pivot-Table-中的默认排序列"><a href="#2-修改透视表-Pivot-Table-中的默认排序列" class="headerlink" title="2. 修改透视表(Pivot Table)中的默认排序列"></a>2. 修改透视表(Pivot Table)中的默认排序列</h4><h4 id="3-透视表表头和表内容列错位"><a href="#3-透视表表头和表内容列错位" class="headerlink" title="3. 透视表表头和表内容列错位"></a>3. 透视表表头和表内容列错位</h4><h4 id="4-修改默认语言为中文"><a href="#4-修改默认语言为中文" class="headerlink" title="4. 修改默认语言为中文"></a>4. 修改默认语言为中文</h4><p>修改<code>superset/config.py</code>文件</p>
<pre class=" language-python"><code class="language-python">BABEL_DEFAULT_LOCALE <span class="token operator">=</span> <span class="token string">"zh"</span>
</code></pre>
<h4 id="5-添加新菜单、菜单跳转到新页面"><a href="#5-添加新菜单、菜单跳转到新页面" class="headerlink" title="5. 添加新菜单、菜单跳转到新页面"></a>5. 添加新菜单、菜单跳转到新页面</h4><h5 id="找到-navbar-menu-html"><a href="#找到-navbar-menu-html" class="headerlink" title="找到 navbar_menu.html"></a>找到 navbar_menu.html</h5><p>添加菜单涉及到权限，需要后台开发人员配合，可以先避开权限问题，让添加的菜单显示出来，完成前端部分工作。</p>
<p>打开 superset/templates/appbuilder/navbar_menu.html 文件，如果 appbuilder 下没有 navbar_menu.html，可以到本地安装的 superset 目录下找，比如我的 superset 装在/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/superset/下，那就可以到这个目录找 templates/appbuilder/navbar_menu.html，在修改过程中遇到项目中没有的 html 文件都是这样操作，找到后如果需要修改这个 html 文件，可以把它复制到自己项目的对应文件夹下。</p>
<h5 id="修改-navbar-menu-html-文件"><a href="#修改-navbar-menu-html-文件" class="headerlink" title="修改 navbar_menu.html 文件"></a>修改 navbar_menu.html 文件</h5><p><code>is_menu_visible</code>是用来过滤菜单的，先把它注释掉</p>
<pre class=" language-html"><code class="language-html">{% for item1 in menu.get_list() %}
<span class="token comment" spellcheck="true">&lt;!-- is_menu_visible --></span>
{% if item1 | is_menu_visible %} {% if item1.childs %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dropdown<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dropdown-toggle<span class="token punctuation">"</span></span> <span class="token attr-name">data-toggle</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dropdown<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>javascript:void(0)<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>noopener<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    {% if item1.icon %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fa {{item1.icon}}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span><span class="token entity" title="&nbsp;">&amp;nbsp;</span> {% endif %} {{_(item1.label)}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>caret<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dropdown-menu<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    {% for item2 in item1.childs %} {% if item2 %} {% if item2.name == '-' %} {%
    if not loop.last %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>divider<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
    {% endif %}
    <span class="token comment" spellcheck="true">&lt;!-- | is_menu_visible  --></span>
    {% elif item2 | is_menu_visible %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>{{ menu_item(item2) }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
    {% endif %} {% endif %} {% endfor %}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
{% else %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>{{ menu_item(item1) }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
{% endif %} {% endif %} {% endfor %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></code></pre>
<h5 id="添加菜单"><a href="#添加菜单" class="headerlink" title="添加菜单"></a>添加菜单</h5><p>修改 superset/app.py 文件</p>
<pre class=" language-python"><code class="language-python">appbuilder<span class="token punctuation">.</span>add_link<span class="token punctuation">(</span>
    <span class="token string">"New Menu"</span><span class="token punctuation">,</span>
    label<span class="token operator">=</span>__<span class="token punctuation">(</span><span class="token string">"New Menu"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    href<span class="token operator">=</span><span class="token string">"/superset/new"</span><span class="token punctuation">,</span>
    icon<span class="token operator">=</span><span class="token string">"fa-cloud-upload"</span><span class="token punctuation">,</span>
    category<span class="token operator">=</span><span class="token string">"New"</span><span class="token punctuation">,</span>
    category_label<span class="token operator">=</span>__<span class="token punctuation">(</span><span class="token string">"New"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    category_icon<span class="token operator">=</span><span class="token string">"fa-wrench"</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre>
<h5 id="添加处理函数"><a href="#添加处理函数" class="headerlink" title="添加处理函数"></a>添加处理函数</h5><p>修改 <code>superset/views/core.py</code> 文件， 在<code>class Superset</code>下添加</p>
<pre class=" language-python"><code class="language-python">@has_access
@expose<span class="token punctuation">(</span><span class="token string">"/new"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">doudizhu_events</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""SQL Editor"""</span>
    bootstrap_data <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> self<span class="token punctuation">.</span>render_template<span class="token punctuation">(</span>
        <span class="token string">"superset/basic.html"</span><span class="token punctuation">,</span> entry<span class="token operator">=</span><span class="token string">"new"</span><span class="token punctuation">,</span> bootstrap_data<span class="token operator">=</span>bootstrap_data
    <span class="token punctuation">)</span>
</code></pre>
<p>在<code>class Superset</code>中定义的处理函数根路径都是<code>/superset</code>,所以现在就有了一个<code>/superset/new</code>的路径，与上面<code>add_link</code>的<code>href</code>属性对应，这里的<code>entry=&quot;new&quot;</code>指向的是 react 的入口文件</p>
<h5 id="添加入口文件"><a href="#添加入口文件" class="headerlink" title="添加入口文件"></a>添加入口文件</h5><p>修改<code>/superset-frontend/webpack.config.js</code>文件，在 config.entry 下添加新的入口</p>
<pre class=" language-javascript"><code class="language-javascript">entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  theme<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>APP_DIR<span class="token punctuation">,</span> <span class="token string">"/src/new/index.jsx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>在对应的<code>/src/new</code>下添加<code>index.jsx</code>文件，可以仿照<code>superset-frontend/src/addSlice</code>下的文件</p>
<p>index.js</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">"react-dom"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">"./App"</span><span class="token punctuation">;</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"app"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>App.jsx</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> hot <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react-hot-loader/root"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> setupApp <span class="token keyword">from</span> <span class="token string">"../../setup/setupApp"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> setupPlugins <span class="token keyword">from</span> <span class="token string">"../../setup/setupPlugins"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> New <span class="token class-name">from</span> <span class="token string">"./New"</span><span class="token punctuation">;</span>

<span class="token function">setupApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setupPlugins</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> appContainer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"app"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bootstrapData <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>appContainer<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"data-bootstrap"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&lt;</span>New <span class="token class-name">datasources</span><span class="token operator">=</span><span class="token punctuation">{</span>bootstrapData<span class="token punctuation">.</span>datasources<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">hot</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h5 id="编写组件代码"><a href="#编写组件代码" class="headerlink" title="编写组件代码"></a>编写组件代码</h5><p>New.jsx 中就是正常的 react 组件代码</p>
<h4 id="6-添加新图例，引入-echarts"><a href="#6-添加新图例，引入-echarts" class="headerlink" title="6. 添加新图例，引入 echarts"></a>6. 添加新图例，引入 echarts</h4><p><a href="https://blog.csdn.net/wenqiang1208/article/details/105362561/" target="_blank" rel="noopener">参考</a></p>
<p>以添加一个简单的折线图为例</p>
<ul>
<li>在 superset-frontend/src/visualizations/ 目录下新建文件夹 SimpleLine，在 SimpleLine 文件夹下新建 images 文件夹,images 文件夹中放 SimpleLine 这个新图例的的缩略图，然后继续在 SimpleLine 文件夹下新建 SimpleLine.jsx,SimpleLinePlugin.js,transformProps.js，</li>
</ul>
<h5 id="新建-SimpleLinePlugin-js"><a href="#新建-SimpleLinePlugin-js" class="headerlink" title="新建 SimpleLinePlugin.js"></a>新建 SimpleLinePlugin.js</h5><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> t <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@superset-ui/translation"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ChartMetadata<span class="token punctuation">,</span> ChartPlugin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@superset-ui/chart"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> transformProps <span class="token keyword">from</span> <span class="token string">"./transformProps"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> thumbnail <span class="token keyword">from</span> <span class="token string">"./images/thumbnail.png"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> metadata <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChartMetadata</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">"Simple Line"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  description<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  thumbnail<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">SimpleLinePlugin</span> <span class="token keyword">extends</span> <span class="token class-name">ChartPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      metadata<span class="token punctuation">,</span>
      transformProps<span class="token punctuation">,</span>
      loadChart<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"./SimpleLine.jsx"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h5 id="新建-transformProps-js"><a href="#新建-transformProps-js" class="headerlink" title="新建 transformProps.js"></a>新建 transformProps.js</h5><p>这个文件单纯的用来转换数据，可以在这里把从后端接收到的数据处理成前端展示需要的格式</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">transformProps</span><span class="token punctuation">(</span>chartProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    height<span class="token punctuation">,</span>
    width<span class="token punctuation">,</span>
    datasource<span class="token punctuation">,</span>
    formData<span class="token punctuation">,</span>
    queryData<span class="token punctuation">,</span>
    rawFormData<span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token operator">=</span> chartProps<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> records<span class="token punctuation">,</span> columns <span class="token punctuation">}</span> <span class="token operator">=</span> queryData<span class="token punctuation">.</span>data<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    width<span class="token punctuation">,</span>
    height<span class="token punctuation">,</span>
    data<span class="token punctuation">:</span> records<span class="token punctuation">,</span>
    columns<span class="token punctuation">:</span> columns<span class="token punctuation">,</span>
    columns_x<span class="token punctuation">:</span> rawFormData<span class="token punctuation">.</span>all_columns_x<span class="token punctuation">,</span>
    columns_y<span class="token punctuation">:</span> rawFormData<span class="token punctuation">.</span>all_columns_y<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h5 id="新建-SimpleLine-jsx"><a href="#新建-SimpleLine-jsx" class="headerlink" title="新建 SimpleLine.jsx"></a>新建 SimpleLine.jsx</h5><p>这部分代码我只放了个大概，主要做的工作就是通过 props 接收参数，然后导入<code>echarts-for-react</code>并使用，关于 echarts 的配置，直接参考 echarts 文档。</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">"prop-types"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactEcharts <span class="token keyword">from</span> <span class="token string">"echarts-for-react"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
  data<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>array<span class="token punctuation">,</span>
  columns<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>columns<span class="token punctuation">,</span>
  width<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>number<span class="token punctuation">,</span>
  height<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>number<span class="token punctuation">,</span>
  columns_x<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>
  columns_y<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//检查类型，其中data包含viz.py中返回的数据，width和height为图表宽高</span>

<span class="token keyword">class</span> <span class="token class-name">SimpleLine</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
      xAxis<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> <span class="token string">"category"</span><span class="token punctuation">,</span>
        data<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      yAxis<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> <span class="token string">"value"</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      series<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          name<span class="token punctuation">:</span> yName<span class="token punctuation">,</span>
          data<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          type<span class="token punctuation">:</span> <span class="token string">"line"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>ReactEcharts
        option<span class="token operator">=</span><span class="token punctuation">{</span>options<span class="token punctuation">}</span>
        style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> height<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>height <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>ReactEcharts<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

SimpleLine<span class="token punctuation">.</span>displayName <span class="token operator">=</span> <span class="token string">"simple line"</span><span class="token punctuation">;</span>
SimpleLine<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> propTypes<span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> SimpleLine<span class="token punctuation">;</span>
</code></pre>
<h5 id="修改文件-superset-frontend-src-setup-setupPlugins-ts"><a href="#修改文件-superset-frontend-src-setup-setupPlugins-ts" class="headerlink" title="修改文件/superset-frontend/src/setup/setupPlugins.ts"></a>修改文件/superset-frontend/src/setup/setupPlugins.ts</h5><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 文件开头导入SimpleLine</span>
<span class="token keyword">import</span> SimpleLine <span class="token keyword">from</span> <span class="token string">'../explore/controlPanels/SimpleLine'</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//注册SimpleLine,在getChartControlPanelRegistry()方法的链式调用后追加一句</span>
<span class="token punctuation">.</span><span class="token function">registerValue</span><span class="token punctuation">(</span><span class="token string">'simple_line'</span><span class="token punctuation">,</span> SimpleLine<span class="token punctuation">)</span>
</code></pre>
<h5 id="修改文件-superset-frontend-src-visualizations-presets-MainPreset-js"><a href="#修改文件-superset-frontend-src-visualizations-presets-MainPreset-js" class="headerlink" title="修改文件/superset-frontend/src/visualizations/presets/MainPreset.js"></a>修改文件/superset-frontend/src/visualizations/presets/MainPreset.js</h5><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//导入</span>
<span class="token keyword">import</span> SimpleLineChartPlugin <span class="token keyword">from</span> <span class="token string">"../SimpleLine/SimpleLinePlugin"</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//在plugins后添加</span>
<span class="token keyword">new</span> <span class="token class-name">SimpleLineChartPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">{</span> key<span class="token punctuation">:</span> <span class="token string">"simple_line"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h5 id="后端代码添加-class-SimpleLine"><a href="#后端代码添加-class-SimpleLine" class="headerlink" title="后端代码添加 class SimpleLine"></a>后端代码添加 class SimpleLine</h5><p>修改<code>/superset/viz.py</code>文件,在<code>viz_types</code>的定义前添加<code>class SimpleLine</code>,下面这段代码根据你需要的数据自行进行处理，这里只做最简单的演示</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">SimpleLine</span><span class="token punctuation">(</span>BaseViz<span class="token punctuation">)</span><span class="token punctuation">:</span>
    viz_type <span class="token operator">=</span> <span class="token string">'simple_line'</span>
    verbose_name <span class="token operator">=</span> <span class="token string">"simple line"</span>
    sort_series <span class="token operator">=</span> <span class="token boolean">False</span>
    is_timeseries <span class="token operator">=</span> <span class="token boolean">False</span>
    <span class="token keyword">def</span> <span class="token function">query_obj</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        d <span class="token operator">=</span> super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>query_obj<span class="token punctuation">(</span><span class="token punctuation">)</span>
        fd <span class="token operator">=</span> self<span class="token punctuation">.</span>form_data <span class="token comment" spellcheck="true">#form_data中包含界面左侧组件内容</span>
        columns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token operator">not</span> fd<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'all_columns'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">#这个字段对应×××组件，不为空</span>
            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Choose Columns'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> fd<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'all_columns'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            d<span class="token punctuation">[</span><span class="token string">'columns'</span><span class="token punctuation">]</span> <span class="token operator">=</span> columns <span class="token comment" spellcheck="true"># all_columns是左侧组件名，后面会提到</span>
        <span class="token keyword">return</span> d

    <span class="token keyword">def</span> <span class="token function">get_data</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> df<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># df是pandas的DataFrame类型</span>
        data <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#假设数据很简单，不需要做别的处理</span>
        <span class="token comment" spellcheck="true"># 如果除了绘图用的数据还有别的信息，可以构造一个字典来返回</span>
        <span class="token comment" spellcheck="true"># data = {'plot_data':plot_data,'other_info':other_info}</span>

        <span class="token keyword">return</span> self<span class="token punctuation">.</span>handle_js_int_overflow<span class="token punctuation">(</span>
            dict<span class="token punctuation">(</span>records<span class="token operator">=</span>df<span class="token punctuation">.</span>to_dict<span class="token punctuation">(</span>orient<span class="token operator">=</span><span class="token string">"records"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> columns<span class="token operator">=</span>list<span class="token punctuation">(</span>df<span class="token punctuation">.</span>columns<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
</code></pre>
<p>这样就大功告成了。</p>
<h4 id="7-三级菜单"><a href="#7-三级菜单" class="headerlink" title="7. 三级菜单"></a>7. 三级菜单</h4><p>菜单的修改都需要注意，登录成功后进入的welcome页面和其他页面使用的模板不一样，welcome页面的菜单是通过react代码写的，写两套的用意大概是向开发者展示两种写法，我们可以使用其中一种，如果两种都用了， 在修改菜单时需要注意两处都要修改：</p>
<ol>
<li><code>superset/templates/appbuilder/navbar_menu.html</code><pre class=" language-python"><code class="language-python"><span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">for</span> item1 <span class="token keyword">in</span> menu<span class="token punctuation">.</span>get_list<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">}</span>
 <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> item1 <span class="token operator">|</span> is_menu_visible <span class="token operator">%</span><span class="token punctuation">}</span>
     <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> item1<span class="token punctuation">.</span>childs <span class="token operator">%</span><span class="token punctuation">}</span>
         <span class="token operator">&lt;</span>li <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"dropdown"</span><span class="token operator">></span>
         <span class="token operator">&lt;</span>a <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"dropdown-toggle"</span> data<span class="token operator">-</span>toggle<span class="token operator">=</span><span class="token string">"dropdown"</span> href<span class="token operator">=</span><span class="token string">"javascript:void(0)"</span> target<span class="token operator">=</span><span class="token string">"_blank"</span> rel<span class="token operator">=</span><span class="token string">"noopener"</span><span class="token operator">></span>
         <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> item1<span class="token punctuation">.</span>icon <span class="token operator">%</span><span class="token punctuation">}</span>
             <span class="token operator">&lt;</span>i <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"fa {{item1.icon}}"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">></span><span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>
         <span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span>
         <span class="token punctuation">{</span><span class="token punctuation">{</span>_<span class="token punctuation">(</span>item1<span class="token punctuation">.</span>label<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>b <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"caret"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>
         <span class="token operator">&lt;</span>ul <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"dropdown-menu"</span><span class="token operator">></span>
         <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">for</span> item2 <span class="token keyword">in</span> item1<span class="token punctuation">.</span>childs <span class="token operator">%</span><span class="token punctuation">}</span>
             <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> item2 <span class="token operator">%</span><span class="token punctuation">}</span>
                 <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> item2<span class="token punctuation">.</span>childs <span class="token operator">%</span><span class="token punctuation">}</span>
                     <span class="token operator">&lt;</span>li <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"dropdown-submenu"</span> style<span class="token operator">=</span><span class="token string">"position:relative"</span><span class="token operator">></span>
                         <span class="token operator">&lt;</span>a <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"dropdown-toggle"</span> data<span class="token operator">-</span>toggle<span class="token operator">=</span><span class="token string">"dropdown"</span> href<span class="token operator">=</span><span class="token string">"javascript:void(0)"</span> target<span class="token operator">=</span><span class="token string">"_blank"</span> rel<span class="token operator">=</span><span class="token string">"noopener"</span><span class="token operator">></span>
                         <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> item2<span class="token punctuation">.</span>icon <span class="token operator">%</span><span class="token punctuation">}</span>
                             <span class="token operator">&lt;</span>i <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"fa {{item2.icon}}"</span> style<span class="token operator">=</span><span class="token string">"width: 18px; text-align: center;"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">></span><span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>
                         <span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span>
                         <span class="token punctuation">{</span><span class="token punctuation">{</span>_<span class="token punctuation">(</span>item2<span class="token punctuation">.</span>label<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>b <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"fa fa-chevron-right"</span> style<span class="token operator">=</span><span class="token string">"margin-left:10px"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>
                         <span class="token operator">&lt;</span>ul <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"dropdown-menu"</span> style<span class="token operator">=</span><span class="token string">"left: 100%;top: -3px;"</span><span class="token operator">></span>
                             <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">for</span> item3 <span class="token keyword">in</span> item2<span class="token punctuation">.</span>childs <span class="token operator">%</span><span class="token punctuation">}</span>
                                 <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> item3 <span class="token operator">%</span><span class="token punctuation">}</span>
                                     <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> item3<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'-'</span> <span class="token operator">%</span><span class="token punctuation">}</span>
                                         <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> <span class="token operator">not</span> loop<span class="token punctuation">.</span>last <span class="token operator">%</span><span class="token punctuation">}</span>
                                             <span class="token operator">&lt;</span>li <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"divider"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
                                         <span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span>
                                         <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">elif</span> item3 <span class="token operator">%</span><span class="token punctuation">}</span>
                                             <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span> menu_item<span class="token punctuation">(</span>item3<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
                                     <span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span>
                                 <span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span>
                             <span class="token punctuation">{</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">}</span>
                      <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
                  <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
              <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">else</span> <span class="token operator">%</span><span class="token punctuation">}</span>
                  <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> item2<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'-'</span> <span class="token operator">%</span><span class="token punctuation">}</span>
                         <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> <span class="token operator">not</span> loop<span class="token punctuation">.</span>last <span class="token operator">%</span><span class="token punctuation">}</span>
                         <span class="token operator">&lt;</span>li <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"divider"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
                         <span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span>
                  <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">elif</span> item2 <span class="token operator">|</span> is_menu_visible <span class="token operator">%</span><span class="token punctuation">}</span>
                      <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span> menu_item<span class="token punctuation">(</span>item2<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
                  <span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span>
              <span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span>
          <span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span>
      <span class="token punctuation">{</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">else</span> <span class="token operator">%</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>li<span class="token operator">></span>
          <span class="token punctuation">{</span><span class="token punctuation">{</span> menu_item<span class="token punctuation">(</span>item1<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span></code></pre>
</li>
<li><pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>NavDropdown
id<span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token string">`menu-dropdown-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>label<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">}</span>
eventKey<span class="token operator">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span>
title<span class="token operator">=</span><span class="token punctuation">{</span>navTitle<span class="token punctuation">}</span>
className<span class="token operator">=</span><span class="token punctuation">{</span>className<span class="token punctuation">}</span>
<span class="token operator">></span>
<span class="token punctuation">{</span>childs<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> index1<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span>
 <span class="token comment" spellcheck="true">//新添加，递归多级菜单</span>
 child<span class="token punctuation">.</span>childs <span class="token operator">&amp;&amp;</span> child<span class="token punctuation">.</span>childs<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token punctuation">(</span>
   <span class="token operator">&lt;</span>MenuObject <span class="token punctuation">{</span><span class="token operator">...</span>child<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">"right_menu_wrap"</span> <span class="token operator">/</span><span class="token operator">></span>
 <span class="token punctuation">)</span> <span class="token punctuation">:</span> child <span class="token operator">===</span> <span class="token string">'-'</span> <span class="token operator">?</span> <span class="token punctuation">(</span>
   <span class="token operator">&lt;</span>MenuItem key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token string">`$</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index1<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">}</span> divider <span class="token operator">/</span><span class="token operator">></span>
 <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>
   <span class="token operator">&lt;</span>MenuItem
     key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>child<span class="token punctuation">.</span>label<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">}</span>
     href<span class="token operator">=</span><span class="token punctuation">{</span>child<span class="token punctuation">.</span>url<span class="token punctuation">}</span>
     eventKey<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index1<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span>
   <span class="token operator">></span>
     <span class="token operator">&lt;</span>i className<span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token string">`fa </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>child<span class="token punctuation">.</span>icon<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
     <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span> <span class="token punctuation">{</span>child<span class="token punctuation">.</span>label<span class="token punctuation">}</span>
   <span class="token operator">&lt;</span><span class="token operator">/</span>MenuItem<span class="token operator">></span>
 <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>NavDropdown<span class="token operator">></span>
</code></pre>
添加js和css<br>修改文件<code>superset/templates/appbuilder/baselayout.html</code><pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>
<span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.dropdown-submenu'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hover</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre>
修改文件<code>superset/templates/superset/basic.html</code><pre class=" language-css"><code class="language-css"><span class="token selector">&lt;style>
<span class="token class">.dropdown-submenu</span> </span><span class="token punctuation">{</span>
 <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.dropdown-submenu</span><span class="token pseudo-class">:hover</span>><span class="token class">.dropdown-menu</span> </span><span class="token punctuation">{</span>
 <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
 <span class="token property">left</span><span class="token punctuation">:</span> <span class="token number">100%</span><span class="token punctuation">;</span>
 <span class="token property">top</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.fa</span> </span><span class="token punctuation">{</span>
 <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">18</span>px<span class="token punctuation">;</span>
 <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
&lt;/style>
</code></pre>
<h4 id="8-修改看板tab的选项卡最大数量"><a href="#8-修改看板tab的选项卡最大数量" class="headerlink" title="8. 修改看板tab的选项卡最大数量"></a>8. 修改看板tab的选项卡最大数量</h4>目录：<code>superset-frontend/src/dashboard/components/gridComponents/Tabs.jsx</code>，修改<code>MAX_TAB_COUNT</code></li>
</ol>
<h4 id="9-扩展看板能保存的最长字符"><a href="#9-扩展看板能保存的最长字符" class="headerlink" title="9. 扩展看板能保存的最长字符"></a>9. 扩展看板能保存的最长字符</h4><p>修改<code>superset/config.py</code>下的<code>SUPERSET_DASHBOARD_POSITION_DATA_LIMIT</code>字段</p>
<h4 id="9-解决在看板中快速切换筛选条件导致的数据错乱（自定义图例）"><a href="#9-解决在看板中快速切换筛选条件导致的数据错乱（自定义图例）" class="headerlink" title="9. 解决在看板中快速切换筛选条件导致的数据错乱（自定义图例）"></a>9. 解决在看板中快速切换筛选条件导致的数据错乱（自定义图例）</h4><p>解决方法：</p>
<ol>
<li>中断请求</li>
<li>记录上一次请求的时间，并将时间作为参数传到后台，请求成功后，后台返回的数据中返回请求时传入的时间，对比两次时间，如果不一致，丢弃请求结果</li>
</ol>
<h4 id="10-修改翻译文件后更新看不到效果"><a href="#10-修改翻译文件后更新看不到效果" class="headerlink" title="10. 修改翻译文件后更新看不到效果"></a>10. 修改翻译文件后更新看不到效果</h4><p>翻译文件修改后需要编译，将.po文件编译为.mo文件才会生效</p>
<pre class=" language-python"><code class="language-python">cd <span class="token operator">~</span><span class="token operator">/</span>superset<span class="token operator">/</span>superset<span class="token operator">/</span>translations<span class="token operator">/</span>zh<span class="token operator">/</span>LC_MESSAGES

msgfmt <span class="token punctuation">.</span><span class="token operator">/</span>messages<span class="token punctuation">.</span>po <span class="token operator">-</span>o <span class="token punctuation">.</span><span class="token operator">/</span>messages<span class="token punctuation">.</span>mo
</code></pre>
<h4 id="11-修改页面默认筛选条件"><a href="#11-修改页面默认筛选条件" class="headerlink" title="11. 修改页面默认筛选条件"></a>11. 修改页面默认筛选条件</h4><p>举个例子，比如数据表页面，默认的显示的筛选条件是<code>表名/以开始</code>，但最常用的是<code>表名/包含</code>，想让页面默认筛选条件显示<code>表名/包含</code>，只用修改配置文件中链接地址，在<code>superset/app.py</code>文件下找到指定页面的菜单修改：</p>
<pre class=" language-javascript"><code class="language-javascript">appbuilder<span class="token punctuation">.</span><span class="token function">add_link</span><span class="token punctuation">(</span>
    <span class="token string">"Tables"</span><span class="token punctuation">,</span>
    label<span class="token operator">=</span><span class="token function">__</span><span class="token punctuation">(</span><span class="token string">"Tables"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    href<span class="token operator">=</span><span class="token string">"/tablemodelview/list/?_flt_2_table_name"</span><span class="token punctuation">,</span>
    icon<span class="token operator">=</span><span class="token string">"fa-table"</span><span class="token punctuation">,</span>
    category<span class="token operator">=</span><span class="token string">"Sources"</span><span class="token punctuation">,</span>
    category_label<span class="token operator">=</span><span class="token function">__</span><span class="token punctuation">(</span><span class="token string">"Sources"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    category_icon<span class="token operator">=</span><span class="token string">"fa-table"</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre>
<p>这里主要修改<code>_flt_2_table_name</code>，其中的数字表示的是筛选条件下拉列表中选项的下标，其中<code>包含</code>的下标是2，所以改为<code>_flt_2_table_name</code></p>

                                                                        
                                    </div>
                                    <footer class="article-footer">
                                        <a data-url="https://forevehg.github.io/2020/08/07/superset二次开发/" data-id="cm8cq1yf8001o221zkf97y34h" class="article-share-link">
                                            分享
                                        </a>
                                        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/superset/">superset</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react/">react</a></li></ul>

                                    </footer>

    </div>

    
        
  <nav class="article-nav">
    
      <a href="/2020/10/25/白话JS观察者模式和发布订阅模式/" class="article-nav-link">
        <strong class="article-nav-caption">前一篇</strong>
        <div class="article-nav-title">
          
            白话JS观察者模式和发布订阅模式
          
        </div>
      </a>
    
    
      <a href="/2020/07/01/学习Echarts配置项/" class="article-nav-link">
        <strong class="article-nav-caption">后一篇</strong>
        <div class="article-nav-title">理解Echarts配置项</div>
      </a>
    
  </nav>


            

                
                    
                        
                            

</article>
</section>
  <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
    <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
    <li><i class="fe fe-bookmark"></i> <span id="busuanzi_value_page_pv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>&copy; 2025 JL&#39;s Blog</li>
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>Theme  <a href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
  </div>
</footer>

</main>
<aside class="sidebar">
  <button class="navbar-toggle"></button>
<nav class="navbar">
  
    <div class="logo">
      <a href="/"><img src="/images/hexo.svg" alt="JL&#39;s Blog"></a>
    </div>
  
  <ul class="nav nav-main">
    
      <li class="nav-item">
        <a class="nav-item-link" href="/">Home</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/archives">Archives</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/gallery">Gallery</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/about">About</a>
      </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="搜索">
        <i class="fe fe-search"></i>
        搜索
      </a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
        <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
          <i class="fe fe-feed"></i>
        </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
</aside>
<script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/lazyload.min.js"></script>
<script src="/js/busuanzi-2.3.pure.min.js"></script>

  <script src="/fancybox/jquery.fancybox.min.js"></script>



  <script src="/js/tocbot.min.js"></script>
  <script>
    // Tocbot_v4.7.0  http://tscanlin.github.io/tocbot/
    tocbot.init({
      tocSelector: '.tocbot',
      contentSelector: '.article-entry',
      headingSelector: 'h1, h2, h3, h4, h5, h6',
      hasInnerContainers: true,
      scrollSmooth: true,
      positionFixedSelector: '.tocbot',
      positionFixedClass: 'is-position-fixed',
      fixedSidebarOffset: 'auto',
    });
  </script>


<script src="/js/ocean.js"></script>

</body>
</html>